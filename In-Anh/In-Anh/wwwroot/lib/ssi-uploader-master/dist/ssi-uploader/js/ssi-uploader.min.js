(function(n,t){typeof module=="object"&&module.exports?module.exports=t(require("jquery")):t(n.jQuery)})(this,function(n){function e(t,i,r){var u,f;if(t=n(t),i=i||t.data("title"),i||(i=t.attr("title")),i){u=n('<div class="ssi-fadeOut ssi-fade ssi-tooltipText">'+i+"<\/div>").appendTo(r.$element);t.one("mouseleave",function(){u.remove()});return f=-16,t.hasClass("ssi-noPreviewSubMessage")&&(f=23),u.css({top:t.position().top-u.height()+f,left:t.position().left-u.width()/2}).removeClass("ssi-fadeOut"),u}}var t=function(n,t){this.options=t;this.$element="";this.language=y[this.options.locale];this.uploadList=[];this.totalProgress=[];this.toUpload=[];this.imgNames=[];this.totalFilesLength=0;this.successfulUpload=0;this.aborted=0;this.abortedWithError=0;this.pending=0;this.inProgress=0;this.currentListLength=0;this.inputName="";this.init(n)},r,u,f;t.prototype.init=function(t){var r,i,f;n(t).addClass("ssi-uploadInput").after(this.$element=n('<div class="ssi-uploader">'));var o=n('<span class="ssi-InputLabel"><button class="ssi-button success">'+this.language.chooseFiles+"<\/button><\/span>").append(t),u=n('<button id="ssi-uploadBtn" class="ssi-push-please ssi-button success ssi-hidden" ><span class="ssi-btnIn">'+this.language.upload+'&nbsp;<\/span><div id="ssi-up_loading" class="ssi-btnIn"><\/div><\/button>'),s=n('<button id="ssi-clearBtn" style="display:inline-block !important" class="ssi-hidden ssi-button info" >'+this.language.clear+"<\/button>");if(this.options.inForm&&u.hide(),this.$element.append(n('<div class="ssi-buttonWrapper">').append(o,u,s)),this.options.preview)r=n('<div id="ssi-previewBox" class="ssi-uploadBox ssi-previewBox '+(this.options.dropZone?"ssi-dropZonePreview ssi-dropZone":"")+'"><div id="ssi-info">'+(this.options.dropZone?'<div id="ssi-DropZoneBack">'+this.language.drag+"<\/div>":"")+'<div id="ssi-fileNumber" class="ssi-hidden">?<\/div><\/div><\/div>'),this.$element.append(r);else{this.$element.addClass("ssi-uploaderNP");var v=n('<table id="ssi-fileList" class="ssi-fileList"><\/table>'),h=n('<span class="ssi-namePreview"><\/span>'),c=n('<div id="ssi-uploadFiles" class="ssi-tooltip ssi-uploadFiles '+(this.options.dropZone?"ssi-dropZone":"")+'"><div id="ssi-uploadProgressNoPreview" class="ssi-uploadProgressNoPreview"><\/div><\/div>').append(h),a=n('<div class="ssi-uploadDetails"><\/div>').append(v);r=n('<div class="ssi-uploadBoxWrapper ssi-uploadBox"><\/div>').append(c,a);this.$element.prepend(r)}i=this;f=o.find(".ssi-uploadInput");this.inputName=f.attr("name")||"files";o.find("button").click(function(n){n.preventDefault();f.trigger("click")});f.on("change",function(){i.toUploadFiles(this.files);i.options.inForm||f.val("")});if(i.options.dropZone){r.on("drop",function(n){n.preventDefault();r.removeClass("ssi-dragOver");var t=n.originalEvent.dataTransfer.files;i.toUploadFiles(t)});r.on("dragover",function(n){return n.preventDefault(),r.addClass("ssi-dragOver"),!1});r.on("dragleave",function(n){return n.preventDefault(),r.removeClass("ssi-dragOver"),!1})}i.options.preview||c.click(function(){i.currentListLength>1&&a.toggleClass("ssi-uploadBoxOpened")});s.click(function(n){n.preventDefault();i.clear()});r.on("mouseenter",".ssi-statusLabel",function(t){var u=n(t.currentTarget),r=u.attr("data-status");r&&r!==""&&e(u,r,i)});r.on("mouseenter","#ssi-fileNumber",function(t){var r=n(t.currentTarget),u=" "+i.language.pending+": "+i.pending+" <br> "+i.language.completed+": "+(i.successfulUpload+i.aborted+i.abortedWithError)+"<br> "+i.language.inProgress+": "+i.inProgress;e(r,u,i)});r.on("click",".ssi-removeBtn",function(t){var f,e,o;t.preventDefault();f=n(t.currentTarget);e=f.data("delete");i.pending--;i.currentListLength--;i.pending<1&&i.$element.find("#ssi-fileNumber").addClass("ssi-hidden");i.pending===0&&u.prop("disabled",!0);i.options.preview?f.parents("table.ssi-imgToUploadTable").remove():(o=f.parents("tr.ssi-toUploadTr"),h.html(i.currentListLength+" files"),o.prev().remove(),o.remove(),i.currentListLength===1&&l(i));i.toUpload[e]=null;i.imgNames[e]=null;i.currentListLength===0&&(i.options.dropZone||r.removeClass("ssi-uploadNoDropZone"),s.addClass("ssi-hidden"),u.addClass("ssi-hidden"))});u.click(function(n){n.preventDefault();i.uploadFiles()})};t.prototype.toUploadFiles=function(t){function tt(){var n=r.imgNames.length,t,f,y,w,a,p;n===0&&(r.options.preview&&(r.options.dropZone||l.addClass("ssi-uploadNoDropZone")),c.removeClass("ssi-hidden"),s.removeClass("ssi-hidden"));s.prop("disabled",!0);r.toUpload[n]=u;t=u.name;f=t.getExtension();r.imgNames[n]=t;r.options.preview?(y=function(r){return'<table class="ssi-imgToUploadTable ssi-pending"><tr><td class="ssi-upImgTd">'+r+'<\/td><\/tr><tr><td><div id="ssi-uploadProgress'+n+'" class="ssi-hidden ssi-uploadProgress"><\/div><\/td><\/tr><tr><td><button data-delete="'+n+'" class=" ssi-button error ssi-removeBtn"><span class="trash10 trash"><\/span><\/button><\/td><\/tr><tr><td>'+i(t,f,15)+"<\/td><\/tr><\/table>"},w=u.type.split("/"),w[0]=="image"?(c.prop("disabled",!0),s.prop("disabled",!0),a=new FileReader,a.onload=function(){h+=y('<img class="ssi-imgToUpload" src=""/><i class="fa-spin fa fa-spinner fa-pulse"><\/i>');o[n]=a.result;v++;e===v?(r.$element.find("#ssi-fileNumber").removeClass("ssi-hidden"),l.append(h),setTimeout(function(){p();c.prop("disabled",!1);s.prop("disabled",!1)},10),c.prop("disabled",!1),s.prop("disabled",!1),h="",e=[]):e/2==Math.round(v)&&(l.append(h),p(),h="")},a.readAsDataURL(u)):(o[n]=null,l.append(y('<div class="document-item" href="test.mov" filetype="'+f+'"><span class = "fileCorner"><\/span><\/div>')),v++)):(s.prop("disabled",!1),r.$element.find(".ssi-namePreview").html(n===0?i(t,f,13):r.currentListLength+1+" "+r.language.files),nt.append('<tr class="ssi-space"><td><\/td><\/tr><tr class="ssi-toUploadTr ssi-pending"><td><div id="ssi-uploadProgress'+n+'" class="ssi-hidden ssi-uploadProgress ssi-uploadProgressNoPre"><\/div><span>'+i(t,f,20)+'<\/span><\/td><td><a data-delete="'+n+'" class="ssi-button ssi-removeBtn  ssi-removeBtnNP"><span class="trash7 trash"><\/span><\/a><\/td><\/tr>'));p=function(){for(var n=0;n<o.length;n++)o[n]!==null&&(l.find("#ssi-uploadProgress"+n).parents("table.ssi-imgToUploadTable").find(".ssi-imgToUpload").attr("src",o[n]).next().remove(),o[n]=null);o=[]}}var w,u,a,d,g;if(typeof this.options.maxNumberOfFiles!="number"||!(this.inProgress+this.pending>=this.options.maxNumberOfFiles)){var r=this,v=0,y,h="",c=this.$element.find("#ssi-uploadBtn"),s=this.$element.find("#ssi-clearBtn"),nt=this.$element.find("#ssi-fileList"),l=this.$element.find(".ssi-uploadBox"),o=[];this.inProgress===0&&this.pending===0&&this.clear();var p=[],b=[],k="",e,f=y=e=t.length;for(typeof this.options.maxNumberOfFiles=="number"&&f>this.options.maxNumberOfFiles-(this.inProgress+this.pending)&&(f=e=this.options.maxNumberOfFiles-(this.inProgress+this.pending)),w=0;w<f;w++)u=t[w],a=u.name.getExtension(),n.inArray(a,this.options.allowed)===-1?(y>f?f++:e--,n.inArray(a,p)===-1&&p.push(a)):(u.size*Math.pow(10,-6)).toFixed(2)>this.options.maxFileSize?(y>f?f++:e--,b.push(i(u.name,a,15))):this.options.allowDuplicates||n.inArray(u.name,this.imgNames)===-1?(c.prop("disabled",!1),tt(u),this.pending++,this.currentListLength++):y>f?f++:e--;d=p.length;g=b.length;d+g>0&&(d>0&&(k=this.language.extError.replaceText(p.toString().replace(/,/g,", "))),g>0&&(k+=this.language.sizeError.replaceText(b.toString().replace(/,/g,", "),this.options.maxFileSize+"mb")),this.options.errorHandler.method(k,this.options.errorHandler.error))}};r=function(n){var t=n.$element.find(".ssi-completed");n.successfulUpload=0;n.aborted=0;n.abortedWithError=0;n.options.preview||t.prev("tr").remove();t.remove()};u=function(n){for(var i=n.$element.find(".ssi-pending"),r=n.imgNames.length,t=0;t<r;t++)n.imgNames[t]===null&&(n.toUpload.splice(t,1),n.imgNames.splice(t,1));n.toUpload.splice(-n.pending,n.pending);n.imgNames.splice(-n.pending,n.pending);n.pending=0;n.options.preview||i.prev("tr").remove();i.remove()};t.prototype.clear=function(n){switch(n){case"pending":u(this);break;case"completed":r(this);break;default:u(this);r(this)}var t=this.$element.find("#ssi-uploadBtn"),i=this.$element.find("#ssi-clearBtn");this.currentListLength=c(this);this.inProgress===0&&(this.totalProgress=[]);this.currentListLength===0&&(i.addClass("ssi-hidden"),t.addClass("ssi-hidden"),this.$element.find("#ssi-fileNumber").addClass("ssi-hidden"),this.totalFilesLength=0,this.options.dropZone||this.$element.find(".ssi-uploadBox").removeClass("ssi-uploadNoDropZone"));i.prop("disabled",!0);t.prop("disabled",!0);this.options.preview||f(this)};f=function(n){n.currentListLength>1?n.$element.find(".ssi-namePreview").html(n.currentListLength+" files"):n.currentListLength===1?l(n):(n.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened"),n.$element.find("#ssi-fileList").empty(),n.$element.find(".ssi-namePreview").empty())};t.prototype.appendFileToFormData=function(t){var i=new FormData;return i.append(this.inputName,t),n.each(this.options.data,function(n,t){i.append(n,t)}),i};t.prototype.tryToTransform=function(n,t){if(typeof this.options.transformFile=="function")try{n=this.options.transformFile(n);n instanceof Promise?n.then(function(n){t(n)}):t(n)}catch(i){if(!this.options.ignoreCallbackErrors)return console.error("There is an error in transformFile"),console.error(i)}else t(n)};t.prototype.uploadFiles=function(){function h(f,e){var l="table.ssi-imgToUploadTable",c,y;for(t.options.preview||(l="tr.ssi-toUploadTr"),c=t.$element.find("#ssi-uploadProgress"+e),c.removeClass("ssi-hidden").parents(l).removeClass("ssi-pending"),y=n.extend({},{xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){var i,u;n.lengthComputable&&(i=n.loaded/n.total*100,c&&c.css({width:i+"%"}),t.totalProgress[e]=i,u=v(t.totalProgress)/(t.inProgress+t.successfulUpload),t.options.preview||t.$element.find("#ssi-uploadProgressNoPreview").removeClass("ssi-hidden").css({width:u+"%"}),r.find("#ssi-up_loading").html(Math.ceil(u)+"%"))},!1),n},"async":!0,beforeSend:function(n,i){var f,u;if(t.uploadList[e]=n,r.find("#ssi-up_loading").html('<i class="fa fa-spinner fa-pulse"><\/i>'),f={name:t.toUpload[e].name,type:t.toUpload[e].type,size:(t.toUpload[e].size/1024).toFixed(2)},typeof t.options.beforeEachUpload=="function")try{u=t.options.beforeEachUpload(f,n,i)}catch(o){o.name=="Error"?t.abort(e,undefined,o.message):t.options.ignoreCallbackErrors||(console.log("There is an error in beforeEachUpload callback. Filename:"+t.toUpload[e].name),console.log(o),t.abort(e,undefined,t.language.wentWrong));return}t.$element.find("input.ssi-uploadInput").trigger("beforeEachUpload.ssi-uploader",[f]);n.status===0&&n.statusText==="canceled"&&(typeof u=="undefined"&&(u=!1),t.abortedWithError++,t.abort(e,u))},type:"POST",method:"POST",data:f,cache:!1,contentType:!1,processData:!1,url:t.options.url,error:function(n,i){if(i!=="abort"){c.addClass("ssi-canceledProgressBar");var r=t.language.error;if(t.abortedWithError++,t.totalProgress.splice(e,1),t.options.preview||(r='<span class="exclamation7"><\/span>'),o(t,e,"error",r,t.language.serverError),t.totalProgress[e]="",t.inProgress--,u.prop("disabled",!1),typeof t.options.onEachUpload=="function")try{t.options.onEachUpload({uploadStatus:"error",responseMsg:t.language.serverError,name:t.toUpload[e].name,size:(t.toUpload[e].size/1024).toFixed(2),type:t.toUpload[e].type})}catch(f){t.options.ignoreCallbackErrors||(console.log("There is an error in onEachUpload callback. File name:"+t.toUpload[e].name),console.log(f))}s(t)&&a(t);console.log(arguments);console.log(" Ajax error: "+i)}}},t.options.ajaxOptions),n.ajax(y).done(function(i,r,f){function v(n,i){n?(w="success",y=t.language.success,k="check",t.successfulUpload++):(c.addClass("ssi-canceledProgressBar"),t.options.preview&&(y=t.language.error),t.abortedWithError++);p=i}var y,p="",w="error",k="exclamation",h,l,b;try{h=n.parseJSON(i)}catch(d){h=i}if(t.options.responseValidation?(l=t.options.responseValidation,typeof l.validationKey=="object"&&l.resultKey=="validationKey"?h.hasOwnProperty(l.validationKey.success)?v(!0,h[l.validationKey.success]):v(!1,h[l.validationKey.error]):h[l.validationKey]==l.success?v(!0,h[l.resultKey]):v(!1,h[l.resultKey])):f.status==200?v(!0,h):v(!1,h),t.options.preview||(y='<span class="'+k+'7"><\/span>'),o(t,e,w,y,p),b={uploadStatus:w,responseMsg:p,name:t.toUpload[e].name,size:(t.toUpload[e].size/1024).toFixed(2),type:t.toUpload[e].type},typeof t.options.onEachUpload=="function")try{t.options.onEachUpload(b,h)}catch(d){console.log("There is an error in onEachUpload callback");console.log(d)}t.$element.find("input.ssi-uploadInput").trigger("onEachUpload.ssi-uploader",[b]);t.inProgress--;u.prop("disabled",!1);s(t)&&a(t);t.uploadList[e]="";t.toUpload[e]="";t.imgNames[e]=""}),i=e,i++;!t.toUpload[i]&&typeof t.toUpload[i]!="undefined";)i++;if(i<t.toUpload.length){const n=t.toUpload[i];t.tryToTransform(n,function(n){var r=t.appendFileToFormData(n);h(r,i)})}}var r,u,t,i,e;if(this.pending>0){if(typeof this.options.beforeUpload=="function")try{this.options.beforeUpload()}catch(c){if(!this.options.ignoreCallbackErrors)return console.log("There is an error in beforeUpload callback"),console.log(c)}for(this.$element.find(".ssi-removeBtn").addClass("ssi-abortUpload").removeClass("ssi-removeBtn").children("span").removeClass("trash7 trash10 trash").addClass(this.options.preview?"ban7w":"ban7"),r=this.$element.find("#ssi-uploadBtn"),u=this.$element.find("#ssi-clearBtn"),r.prop("disabled",!0),t=this,i=this.totalFilesLength,this.totalFilesLength===0||this.options.preview||f(this),this.inProgress+=this.pending,this.totalFilesLength+=this.pending,this.pending=0,this.inProgress===this.currentListLength&&u.prop("disabled",!0);!t.toUpload[i];)i++;e=t.toUpload[i];t.tryToTransform(e,function(n){var r=t.appendFileToFormData(n);h(r,i)})}};var o=function(n,t,i,r,u){var e="",o="table.ssi-imgToUploadTable",f;n.options.preview||(e="ssi-noPreviewSubMessage",o="tr.ssi-toUploadTr",n.currentListLength===1&&(n.errors=u));f=n.$element.find(".ssi-abortUpload[data-delete='"+t+"']");f.parents(o).addClass("ssi-completed");f.after(h(i,r,u,e)).remove()},s=function(n){return n.inProgress===0},h=function(n,t,i,r){return'<span class="ssi-statusLabel '+r+" "+n+'" data-status="'+i+'">'+t+"<\/span>"},c=function(n){return n.inProgress+n.successfulUpload+n.aborted+n.abortedWithError+n.pending},l=function(n){var t=n.$element.find("#ssi-fileList").find("span").html(),r=t.getExtension();n.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened");n.$element.find(".ssi-namePreview").html(i(t,r,15))},a=function(n){var u;if(!n.options.preview){var t="error",i="",r="";n.abortedWithError>0?(i=n.totalFilesLength===1?n.errors:n.language.someErrorsOccurred,r='<span class="exclamation23"><\/span>'):n.aborted>0&&n.successfulUpload===0?(r='<span class="ban23"><\/span>',i=n.language.aborted):n.successfulUpload>0&&(t="success",r='<span class="check23"><\/span>',i=n.language.sucUpload);n.$element.find(".ssi-namePreview").append(h(t,r,i,"ssi-noPreviewMessage"));n.$element.find("#ssi-uploadProgressNoPreview").removeAttr("styles").addClass("ssi-hidden")}if(typeof n.options.onUpload=="function")try{n.options.onUpload(t)}catch(f){n.options.ignoreCallbackErrors||(console.log("There is an error in onUpload callback"),console.log(f))}n.$element.find("input.ssi-uploadInput").trigger("onUpload.ssi-uploader",[t]);u=n.$element.find("#ssi-uploadBtn");n.$element.find("#ssi-clearBtn").prop("disabled",!1);u.prop("disabled",!1).find("#ssi-up_loading").empty();n.pending===0&&(u.addClass("ssi-hidden"),n.toUpload=[],n.imgNames=[],n.totalFilesLength=0);n.uploadList=[];n.totalProgress=[];n.currentListLength=c(n);n.inProgress=0};n.fn.ssi_uploader=function(i){var u={allowDuplicates:!1,url:"",data:{},locale:"en",preview:!0,dropZone:!0,maxNumberOfFiles:"",responseValidation:!1,ignoreCallbackErrors:!1,maxFileSize:2,inForm:!1,ajaxOptions:{},onUpload:function(){},onEachUpload:function(){},beforeUpload:function(){},beforeEachUpload:function(){},allowed:"",errorHandler:{method:function(n){alert(n)},success:"success",error:"error"}},r=n.extend(!0,u,i);return r.allowed=r.allowed||["jpg","jpeg","png","bmp","gif"],this.each(function(){var i=n(this),u;if(i.is('input[type="file"]')){if(i.data("ssi_upload"))return;u=new t(this,r);i.data("ssi_upload",u)}else console.log("The targeted element is not file input.")})};String.prototype.replaceText=function(){for(var i=Array.apply(null,arguments),t=this,n=0;n<i.length;n++)t=t.replace("$"+(n+1),i[n]);return t};String.prototype.getExtension=function(){return this.split(".").pop().toLowerCase()};var i=function(n,t,i){var r,u,f,e;if(typeof t=="undefined"&&(t=""),typeof i=="undefined"&&(i=10),r=4,!(i<r))return u=t.length,f=n.length,f-2>i?(n=n.substring(0,i),e=n.length-u,n=n.substring(0,e),n+"..."+t):n},v=function(n){for(var i=0,t=0;t<n.length;t++)typeof n[t]=="number"&&(i+=n[t]);return i},y={en:{success:"Success",sucUpload:"Successful upload",chooseFiles:"Choose files",uploadFailed:"Upload failed",serverError:"Internal server error",error:"Error",abort:"Abort",aborted:"Aborted",files:"files",upload:"Upload",clear:"Clear",drag:"Drag n Drop",sizeError:"$1 exceed the size limit of $2",extError:"$1 file types are not supported",someErrorsOccurred:"Some errors occurred!",wentWrong:"Something went wrong!",pending:"Pending",completed:"Completed",inProgress:"In progress"},gr:{success:"Επιτυχία",sucUpload:"Επιτυχής μεταφόρτωση",chooseFiles:"Επιλέξτε αρχεία",uploadFailed:"Η μεταφόρτωση απέτυχε!",serverError:"Εσωτερικό σφάλμα διακομιστή!",error:"Σφάλμα",abort:"Διακοπή",aborted:"Διακόπηκε",files:"αρχεία",upload:"Μεταφόρτωση",clear:"Εκκαθάριση",drag:"Συρετε εδώ...",sizeError:"$1 έχει ξεπεράσει το όριο των $2.",extError:"$1 αρχεία δεν υποστηρίζονται.",someErrorsOccurred:"Σημειώθηκαν ορισμένα λάθη!",wentWrong:"Κάτι πήγε στραβά!",pending:"Σε εκκρεμότητα",completed:"Ολοκληρομένα",inProgress:"Σε εξέλιξη"},fr:{success:"Succès",sucUpload:"Envoi réussi",chooseFiles:"Choisissez fichiers",uploadFailed:"Envoi échoué",serverError:"Erreur interne du serveur",error:"Erreur",abort:"Annuler",aborted:"Annulé",files:"Fichiers",upload:"Envoyer",clear:"Effacer",drag:"Glisser déposer",sizeError:"$1 excède la taille limite de $2",extError:"Types de fichier $1 non autorisé",someErrorsOccurred:"Une erreur a eu lieu !",wentWrong:"Une erreur a eu lieu !",pending:"Εn attendant",completed:"Terminé",inProgress:"En cours"},zh_CN:{success:"上传成功",sucUpload:"上传成功",chooseFiles:"选择文件",uploadFailed:"上传失败",serverError:"服务器内部错误",error:"错误",abort:"中止",aborted:"已中止",files:"文件",upload:"上传",clear:"清空",drag:"将图片拖拽至此并释放",sizeError:"$1 超出了 $2 的大小限制",extError:"$1 类型不被支持",someErrorsOccurred:"发生了一些错误!",wentWrong:"出问题了哦!",pending:"等待上传",completed:"完成",inProgress:"正在上传"}}});